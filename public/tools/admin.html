<!doctype html>
<html lang="pt-BR">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RSVP • Admin</title>
<style>
  body { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
  h1 { margin-top: 0; }
  .row { display: flex; gap: .5rem; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; }
  input, button { padding: .5rem .75rem; }
  pre { background: #0b1020; color: #d6e2ff; padding: 1rem; border-radius: .5rem; max-height: 60vh; overflow: auto; }
</style>

<h1>Lista de Presenças</h1>

<div class="row">
  <label>ADMIN_TOKEN: <input id="token" type="password" placeholder="cole aqui seu token" /></label>
  <button id="save">Usar token</button>
  <button id="reload">Recarregar</button>
  <a id="csv" href="#" download="rsvp.csv">Baixar CSV</a>
</div>

<pre id="out">Aguardando...</pre>

<script>
  const $ = (s) => document.querySelector(s);
  const out = $('#out');
  const tokenInput = $('#token');

  tokenInput.value = localStorage.getItem('RSVP_ADMIN_TOKEN') || '';

  $('#save').onclick = () => {
    localStorage.setItem('RSVP_ADMIN_TOKEN', tokenInput.value || '');
    alert('Token salvo.');
  };

  async function load() {
    const token = tokenInput.value.trim();
    if (!token) { alert('Informe o ADMIN_TOKEN'); return; }
    out.textContent = 'Carregando...';

    try {
      const r = await fetch('/api/rsvp', { headers: { Authorization: `Bearer ${token}` } });
      const j = await r.json();
      out.textContent = JSON.stringify(j, null, 2);
    } catch (e) {
      out.textContent = 'Erro ao carregar: ' + (e && e.message || e);
    }
  }

  $('#reload').onclick = load;

  $('#csv').onclick = async (e) => {
    e.preventDefault();
    const token = tokenInput.value.trim();
    if (!token) { alert('Informe o ADMIN_TOKEN'); return; }
    const r = await fetch('/api/rsvp.csv', { headers: { Authorization: `Bearer ${token}` } });
    if (!r.ok) { alert('Falha ao baixar CSV'); return; }
    const blob = await r.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'rsvp.csv';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  };

  if (tokenInput.value) load();
</script>
</html>
